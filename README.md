# Course Helper

一个Electron+Vue3作为前端，Python作为本地后端的桌面端软件。

[TOC]

## 需求分析

为进一步深化教育改革，加快我校优质教学资源的共建共享，我校引进了清华大学教育技术研究所研发的支撑教与学的网络支撑环境的综合平台，建立了厦门大学课程中心，即[couse平台](http://course.xmu.edu.cn/)。

course平台已有十年的使用历史，由于缺少更新、维护，使用起来非常不方便。但是由于学校强制要求教师学生使用course平台，我们不得不在平台上查看、下载课件，上传作业等等。加上近年主流浏览器都已经停止对Flash的支持、course平台登录添加伪VPN验证等等问题，这个平台的变得愈发不方便。

由此，个人决定做一款PC端course助手，方便同学们使用course网站。



## 软件功能与特点

### 1. 快捷登录 ✔️

用户在保存账号密码到本地后，启动即可快速登录 Course 网站。无需输入密码、拖动滑块验证码

### 2. UI界面 ✔️

~~功能可以差点，UI必须好看~~  

Course Helper的UI要配得上XMUers的颜

### 3. 课程列表查看 ✔️

可以查看课程列表与课程基本信息

### 4. 课件批量下载 🛠️

进入某课程后，可以勾选需要下载的课程资源文件，批量下载

### 5. 作业查看与提交 🛠️

爬取课程的作业信息，显示DDL等信息，并可以使用软件内富文本编辑器进行编辑与提交



## 难点分析与解决

### 前后端通信 ⭐⭐⭐⭐

通信方式的选择：最早打算使用RPC等通信，但是问题很多，最后还是决定主体使用本地HTTP通信(fastapi)

虽然HTTP通信速度上不如RPC通信，但是用于本地HTTP通信速度差异可以忽略不计。



本来不想使用其他通信方式的，但是碰到了技术上的难点。

为了双向通信，让后端能够主动向前端发送请求，不得不额外使用了WebSocket。

然后在使用WebSocket时又出现了新的问题，因为WS通信不像HTTP能有每个请求的回复，需要进一步处理。

最后通过添加消息id判断出每个消息所属的请求，并且使用`asyncio.Future`来等待消息回复，成功拿到回复。



### 登录 ⭐⭐⭐⭐⭐

存在诸多阻碍，统一身份认证和VPN验证，网站频繁的重定向，对爬虫非常非常不友好。

本来打算用`selenium`或`pyppeteer`蒙混过关。

但万幸，~~某智教育公司、某瑞达公司~~没把纯`requests`的路给堵死

**重难点：**

1. vpn滑块验证码

   获取滑块验证码的图片，PIL解析滑块图片，post通过

   

2. 统一身份认证的请求加密

   key藏在页面源码内里，简单找一找就行，但是用于加密的js代码比较麻烦。

   js源码可以取到，但是不方便直接用python调用（考虑到用户的电脑不一定装了nodejs）

   所以只能用最稳妥的前后端通信的方式，让前端把加密代码执行后返回给后端

   （~~感觉多此一举，但是谁让这是Python的大作业，Electron前端只负责展示数据~~）

   

2. 登录状态的维护

   使用同一个request.Session进行请求，维持前后的cookie等缓存

   并且再每次请求前检查登录状态，及时重新登录

   

### UI设计与实现 ⭐⭐⭐⭐⭐

从零开始的`Electron + Vue3`生活，不得不说这俩虽然开发起来很简单，但是从零开始真的会遇到非常多问题。

按时间顺序列举一下**从零开始**到**比较流畅地开发**的这段历程：

1. 解决electron环境配置问题
2. electron的不同进程通信，简单入门
3. Vue2的学习
4. Vue2迁移到Vue3的学习
5. electron使用vue的配置
6. 简单使用electron+vue3
7. Vuex，Vue Router的学习和使用
8. UI组件库使用（Native UI）
9. 解决electron打包的各种问题



### 信息的爬取⭐⭐

course使用jsp构建的动态网页，使用正则+lxml提取需要的信息



### 部分页面的元素不方便提取后重构 ⭐⭐⭐

使用原始网页，但使用js修改页面内容



### 作业提交Flash问题 ⭐⭐⭐

Electron 使用 Pepper Flash 插件，从而启用Flash



### 软件打包 ⭐

Python，Electron的打包体积，那是大哥不说二哥。



## 技术栈

### Python（后端）

开发快捷，且期末大作业要求。

### Electron+Vue3（前端）

开发快速，UI美观，虽然体积偏大，但具有浏览器性质，方便本项目的一些操作。



